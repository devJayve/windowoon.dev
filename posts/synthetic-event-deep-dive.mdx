---
title: "í•©ì„± ì´ë²¤íŠ¸(Synthetic Event) Deep Dive"
date: "2024-12-25"
author: "ê¹€ë„ìš´"
---

import { CodeBlock } from './components/CodeBlock'

## ê³¼ì œ ì…€í”„íšŒê³ 
Reactì˜ í•µì‹¬ ê°œë…ë“¤ì— ëŒ€í•œ ì‹¬ì¸µì ì¸ ì´í•´ê°€ ë¶€ì¡±í–ˆë˜ í„°ë¼, Virtual DOMì˜ ë³¸ì§ˆì ì¸ ë©”ì»¤ë‹ˆì¦˜ì— ëŒ€í•´ì„œë„ í”¼ìƒì ìœ¼ë¡œë§Œ ì´í•´í•˜ê³  ìˆì—ˆìŠµë‹ˆë‹¤.
ëˆ„êµ°ê°€ Virtual DOMì— ëŒ€í•´ ë¬¼ì–´ë³¸ë‹¤ë©´ ì•„ë§ˆ ì´ë ‡ê²Œ ë‹µë³€í–ˆì„ ê²ƒ ê°™ìŠµë‹ˆë‹¤..
> *"ê°€ìƒë”ì€ diffing ì•Œê³ ë¦¬ì¦˜ìœ¼ë¡œ DOM ì—…ë°ì´íŠ¸ë¥¼ ìµœì í™”í•´ì„œ ë¹ ë¥´ê²Œ ëŒì•„ê°„ë‹¤!"*

ê·¸ë˜ì„œ ì¤€ì¼ ì½”ì¹˜ë‹˜ì˜ ë°œì œ ì‹œê°„ì— ë“¤ì—ˆë˜ "ê°€ìƒ ë”ì´ í•­ìƒ ì„±ëŠ¥ í–¥ìƒì„ ë³´ì¥í•˜ì§€ ì•Šìœ¼ë©°
ì‘ì€ ê·œëª¨ì—ì„  ì˜¤íˆë ¤ ì˜¤ë²„í—¤ë“œê°€ ë  ìˆ˜ ìˆë‹¤"ëŠ” ë§ì”€ì´ ë‚˜ë¦„ì˜ ì¶©ê²©ì´ì—ˆìŠµë‹ˆë‹¤. ê·¸ë ‡ë‹¤ë³´ë‹ˆ ê°€ìƒ ë”ì„ ì´ë¡ ì ì¸ ê¸€ë¡œ ì‚´í´ë³´ëŠ”
ê²ƒ ë¿ë§Œ ì•„ë‹ˆë¼ ì§ì ‘ êµ¬í˜„í•´ë³´ë©° ë” êµ¬ì²´ì ìœ¼ë¡œ ì¼€ì´ìŠ¤ë¥¼ ê³µë¶€í•  ìˆ˜ ìˆì–´ ë”ë”ìš± ì¢‹ì€ ê¸°íšŒì˜€ìŠµë‹ˆë‹¤. ì£¼ë¡œ í•™ìŠµí•œ ë‚´ìš©ì€
ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

- ê°€ìƒë”ì„ ìƒì„±í•˜ëŠ” íŒŒì´í”„ë¼ì¸ì— ëŒ€í•œ ì´í•´
- ê°€ìƒë”ì˜ í•„ìš”ì„±ê³¼ íš¨ìœ¨ì ì¸ ê´€ë¦¬ (Garbage Collection ê¸°ë°˜ ë™ì‘ ë“±)
- í•©ì„± ì´ë²¤íŠ¸ ì‹œìŠ¤í…œê³¼ ì´ë²¤íŠ¸ ìœ„ì„ ë©”ì»¤ë‹ˆì¦˜ ì„¤ê³„

ê°€ì¥ ê³ ë¯¼í•˜ë©° êµ¬í˜„í•œ ë¶€ë¶„ì€ **ì´ë²¤íŠ¸ ì²˜ë¦¬ ì‹œìŠ¤í…œ**ì…ë‹ˆë‹¤. DOM ì´ë²¤íŠ¸ë¥¼ ë£¨íŠ¸ ì»¨í…Œì´ë„ˆì— ìœ„ì„í•˜ë˜, ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ë“¤ì„ Mapì— ì €ì¥í•˜ê³ 
ìœ ì§€í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ì„¤ê³„í–ˆìŠµë‹ˆë‹¤. ì—¬ê¸°ì— ë¦¬ì•¡íŠ¸ì˜ í•©ì„± ì´ë²¤íŠ¸ ì‹œìŠ¤í…œ ë°©ì‹ì„ ì°¨ìš©í•˜ì—¬ í•µì‹¬ ì½”ë“œë¥¼ ë¦¬íŒ©í† ë§í•˜ì˜€ìŠµë‹ˆë‹¤. ì´ë¥¼ ìœ„í•´ ë¦¬ì•¡íŠ¸ ì†ŒìŠ¤ì½”ë“œë¥¼ ~~Deep Dive~~(Shallow Diveì— ê°€ê¹Œìš´..) í•´ë³´ì•˜ìŠµë‹ˆë‹¤.

### React í†ºì•„ë³´ê¸° (ì´ë²¤íŠ¸ ì‹œìŠ¤í…œ)
> React ë¼ì´ë¸ŒëŸ¬ë¦¬ ì½”ë“œë¥¼ ì§ì ‘ ë³´ë©° í•´ì„í•œ ë‚´ìš©ì´ë‹¤ë³´ë‹ˆ ì˜ëª»ëœ ë‚´ìš©ì— ëŒ€í•œ ì§€ì , í”¼ë“œë°±ì„ ì ê·¹ í™˜ì˜í•©ë‹ˆë‹¤ ğŸ™Œ

ì´ë²¤íŠ¸ ì²˜ë¦¬ì˜ í•µì‹¬ íŒŒì´í”„ë¼ì¸ì„ ë”°ë¼ê°€ë³´ê² ìŠµë‹ˆë‹¤. ë¦¬ì•¡íŠ¸ëŠ” ë£¨íŠ¸ ì»¨í…Œì´ë„ˆë¥¼ ìƒì„±í•˜ë©´ì„œ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë¥¼ ë“±ë¡í•©ë‹ˆë‹¤.
```js
export function createRoot(container, options) {

  // rootContainerë¥¼ ì„¤ì •
  const rootContainerElement = container.nodeType === COMMENT_NODE
    ? container.parentNode
    : container;


  // rootContainerì— ì§€ì›í•˜ëŠ” ì´ë²¤íŠ¸ì— ëŒ€í•œ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
  listenToAllSupportedEvents(rootContainerElement);
```
`listenToAllSupportedEvents`ëŠ” Native Event Setì„ ìˆœíšŒí•˜ë©´ì„œ ê°ê°ì˜ ì´ë²¤íŠ¸ ë§ˆë‹¤
ê°œë³„ì ìœ¼ë¡œ ë¦¬ìŠ¤ë„ˆë¥¼ ë“±ë¡í•©ë‹ˆë‹¤. ì´ë•Œ ì´ë²¤íŠ¸ ìœ„ì„ ì—¬ë¶€ì— ë”°ë¼ ì ì ˆí•œ í”Œë˜ê·¸ë¥¼ ì„¤ì •í•˜ê³  ì´ë²¤íŠ¸ë¥¼ ë“±ë¡í•©ë‹ˆë‹¤.
```js
export function listenToAllSupportedEvents(rootContainerElement) {
  ...
  allNativeEvents.forEach(domEventName => {
    if (!nonDelegatedEvents.has(domEventName)) {
      listenToNativeEvent(domEventName, false, rootContainerElement);
    }
    listenToNativeEvent(domEventName, true, rootContainerElement);
  })
}
```
`listenToNativeEvent` í•¨ìˆ˜ ë‚´ì—ì„œ flagì— ëŒ€í•œ ë³„ë„ì˜ ì²˜ë¦¬ë¥¼ í•œ ë’¤ `addTrappedEventListener`ë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤. `createEventListenerWrapperWithPriority`
í•¨ìˆ˜ë¥¼ í†µí•´ ì–´ë–¤ ìš°ì„ ìˆœìœ„ì— ë”°ë¼ listenerë¥¼ ê°€ì ¸ì˜¤ê³  í•´ë‹¹ ë¦¬ìŠ¤ë„ˆë¥¼ flag ê°’ì— ë”°ë¼ ì´ë²¤íŠ¸ ë²„ë¸” ë¦¬ìŠ¤ë„ˆ, ì´ë²¤íŠ¸ ìº¡ì³ ë¦¬ìŠ¤ë„ˆë¡œ ë¶„ë¥˜í•˜ì—¬ ë“±ë¡í•©ë‹ˆë‹¤.

```js
function addTrappedEventListener(
  targetContainer,
  domEventName,
  eventSystemFlags,
  isCapturePhaseListener,
  isDeferredListenerForLegacyFBSupport
) {
  let listener = createEventListenerWrapperWithPriority(
    targetContainer,
    domEventName,
    eventSystemFlags,
  );
  if (isCapturePhaseListener) { // ìº¡ì³ í˜ì´ì¦ˆ ë¦¬ìŠ¤ë„ˆ
    unsubscribeListener = addEventCaptureListener(
      targetContainer,
      domEventName,
      listener,
    );
  } else { // ë²„ë¸” í˜ì´ì¦ˆ ë¦¬ìŠ¤ë„ˆ
    unsubscribeListener = addEventBubbleListener(
      targetContainer,
      domEventName,
      listener,
    );
  }
}
```
ì´ì œ ë¦¬ìŠ¤ë„ˆê°€ ìµœì¢…ì ìœ¼ë¡œ ë“±ë¡ë˜ëŠ” ì‹œì ì€ ì•Œì•˜ìœ¼ë‹ˆ ìš°ì„ ìˆœìœ„ì— ë”°ë¼ ë¦¬ìŠ¤ë„ˆë¥¼ ìƒì„±í•˜ëŠ” ë¡œì§ì„ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤. ì•„ë˜ `getEventPriority`ì˜ ê²½ìš° ì´ë²¤íŠ¸ ì´ë¦„ì— ë”°ë¼
ë¦¬ì•¡íŠ¸ì—ì„œ ì§€ì •í•œ ìš°ì„ ìˆœìœ„ë¥¼ êµ¬ë³„í•˜ì—¬ ê°’ì„ ê°€ì ¸ì˜µë‹ˆë‹¤. ì—¬ê¸°ì„œ ìš°ì„ ìˆœìœ„ì— ë”°ë¼ ê°ê° ë‹¤ë¥¸ í•¨ìˆ˜ë¥¼ ë³€ìˆ˜ì— í• ë‹¹í•´ì£¼ê³  ìˆëŠ”ë° í•µì‹¬ì€ ëª¨ë‘ ê°™ì€ `dispatchEvent`ë¥¼ ê¸°ë°˜ìœ¼ë¡œ
ë‘ê³  ìˆë‹¤ëŠ” ê²ƒì…ë‹ˆë‹¤. ê²°êµ­ í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì‹¤ì œ ì´ë²¤íŠ¸ê°€ ë°œìƒë˜ì—ˆì„ ë•Œ `dispatchEvent`ê°€ íŠ¸ë¦¬ê±°ë˜ê²Œ ë©ë‹ˆë‹¤.
```js
export function createEventListenerWrapperWithPriority(
  targetContainer,
  domEventName,
  eventSystemFlags
) {
  const eventPriority = getEventPriority(domEventName);
  let listenerWrapper;
  switch (eventPriority) {
    case DiscreteEventPriority:
      listenerWrapper = dispatchDiscreteEvent;
      break;
    case ContinuousEventPriority:
      listenerWrapper = dispatchContinuousEvent;
      break;
    case DefaultEventPriority:
    default:
      listenerWrapper = dispatchEvent;
      break;
  }
}
```
`dispatchEvent`ëŠ” ëª‡ ê°€ì§€ ê³¼ì •ì„ ê±°ì³ `dispatchEventsForPlugins`í•¨ìˆ˜ì— ë„ë‹¬í•˜ê²Œ ë©ë‹ˆë‹¤.
í•´ë‹¹ í•¨ìˆ˜ì—ì„œëŠ” `extractEvents` -> `processDispatchQueue` ìˆœìœ¼ë¡œ í˜¸ì¶œë©ë‹ˆë‹¤.
ë¨¼ì € `extractEvent`ì˜ íë¦„ì„ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤.
1. í•´ë‹¹ í•¨ìˆ˜ëŠ” ì´ë²¤íŠ¸ëª…ì„ ê¸°ì¤€ìœ¼ë¡œ í•©ì„±ì´ë²¤íŠ¸ë¥¼ ìƒì„±
2. target ì»¨í…Œì´ë„ˆë¥¼ ê¸°ì¤€ìœ¼ë¡œ íƒìƒ‰í•˜ë©° ë¦¬ìŠ¤ë„ˆë¥¼ ìˆ˜ì§‘ (`accumulateSinglePhaseListeners`)
3. í•©ì„±ì´ë²¤íŠ¸ì™€ ë¦¬ìŠ¤ë„ˆë“¤ì„ dispatchQueueì— ì‚½ì…

ìœ„ì™€ ê°™ì€ ê³¼ì •ì„ í†µí•´ í•©ì„±ì´ë²¤íŠ¸ ìƒì„±ê³¼ target ì»¨í…Œì´ë„ˆì—ì„œ ë¦¬ìŠ¤ë„ˆë¥¼ ìˆ˜ì§‘í•˜ì—¬ ë“±ë¡í•˜ì˜€ë‹¤ë©´ `processDispatchQueue`
ë¥¼ í†µí•´ ì ì ˆí•œ ìš°ì„ ìˆœìœ„ì— ë”°ë¼ í ì•ˆì˜ ì´ë²¤íŠ¸ë“¤ì„ ì²˜ë¦¬í•˜ê²Œ ë©ë‹ˆë‹¤.
ì‹¤ì œ ë¦¬ì•¡íŠ¸ì—ì„œëŠ” í›¨ì”¬ ë” ë³µì¡í•œ ì—£ì§€ ì¼€ì´ìŠ¤ë“¤ì„ ê³ ë ¤í•˜ê³  ìˆì§€ë§Œ ì´ë²ˆ ë¶„ì„ì„ í†µí•´ ë¦¬ì•¡íŠ¸ ì´ë²¤íŠ¸ ì‹œìŠ¤í…œì˜ ì•„í‚¤í…ì³ë¥¼ ì´í•´í•  ìˆ˜ ìˆëŠ” ì¢‹ì€ ê¸°íšŒì˜€ìŠµë‹ˆë‹¤.

### í•©ì„± ì´ë²¤íŠ¸ ì‹¤ì œ êµ¬í˜„
ìœ„ì™€ ê°™ì€ ë¦¬ì•¡íŠ¸ì˜ ì ‘ê·¼ ë°©ì‹ì„ ì°¸ê³ í•˜ì—¬ í•©ì„± ì´ë²¤íŠ¸ ì‹œìŠ¤í…œì„ êµ¬í˜„í•´ë³´ì•˜ìŠµë‹ˆë‹¤. ë¨¼ì € ì§€ì›í•˜ëŠ” ì´ë²¤íŠ¸ëª…ì„ ê¸°ì¤€ìœ¼ë¡œ ê°ê° ë¦¬ìŠ¤ë„ˆë¥¼ ë“±ë¡í•©ë‹ˆë‹¤.
```js
export function setupEventListeners(root) {
  supportedEventNames.forEach((eventName) => {
    listenToNativeEvent(root, eventName);
  });
}
```
ì´ë•Œ ë¦¬ìŠ¤ë„ˆê°€ íŠ¸ë¦¬ê±°ë  ê²½ìš° `dispatchEvent`ê°€ í˜¸ì¶œë©ë‹ˆë‹¤. ìœ„ì—ì„œ ë¦¬ì•¡íŠ¸ì˜ íë¦„ê³¼ ê°™ì´ `extractEvent`í•¨ìˆ˜ë¥¼ í†µí•´
í•©ì„± ì´ë²¤íŠ¸ë¥¼ ìƒì„±í•˜ê³ , target ì»¨í…Œì´ë„ˆë¥¼ ê¸°ì¤€ìœ¼ë¡œ ë²„ë¸”ë§ ìˆœíšŒí•˜ë©° í•¸ë“œëŸ¬ë¥¼ ìˆ˜ì§‘í•©ë‹ˆë‹¤.
```js
const syntheticEvent = extractEvent(
  domEventName,
  nativeEvent,
  nativeEvent.target,
);
const dispatchQueue = accumulateListeners(
  nativeEvent.target,
  targetContainer,
  domEventName,
);
```
